<!DOCTYPE html>
<html>
  <head>
    <title>surfnwork</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
      integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
      crossorigin="anonymous"
    />
<script>
      var $ = jQuery = require("jquery")
  </script>
    <link
      rel="stylesheet"
      type="text/css"
      href="bootstrap/css/bootstrap.min.css"
    />
    <!-- jQuery library -->

    <script type="text/javascript" src="jquery/jquery-3.5.1.min.js"></script>
   
    <script type="text/javascript" src="jquery/js/lightbox.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <link
      rel="stylesheet"
      type="text/css"
      href="bootstrap/js/bootstrap.min.js"
    />
	<link
      rel="stylesheet"
      type="text/css"
      href="jquery/js/lightbox.min.css"
    />

    <style>
      .nav-tabs > li.active > a,
      .nav-tabs > li.active > a:focus,
      .nav-tabs > li.active > a:hover {
        color: #fff;
        font-weight: bold;
        cursor: default;
        background-color: #46a9d7;
        border: 1px solid #ddd;
        border-bottom-color: transparent;
      }

      .coleft {
        background-color: #53c0e2;
        color: #fff;
        float: left;
        border-radius: 15px;
        padding: 16px;
      }

      .coright {
        background-color: grey;
        color: #fff;
        float: right;
        border-radius: 15px;
        padding: 16px;
      }

      .fontsize {
        font-size: 12px;
      }
      .time {
        float: right;
        font-size: 10px;
      }
	  .attach{
	  background: #286090;
    padding: 6px 10px;
    color: white;
    border-radius: 6px;
	  }
    </style>
  </head>

  <body>
    <div class="container text-center">
      <!--<div class="row">
        <div class="col-sm-6 col-xs-8">
          <img src="image/logo.png" width="120px" />
        </div>
        <div class="col-sm-6 col-xs-4">
          <ul type="none" style="margin-top: 12px">
            <li><i class="fa fa-window-close" style="color: red"></i></li>
          </ul>
        </div>
      </div>-->
      <div class="row">
        <!--<div class="col-sm-12">
          <p>
            <span style="font-size: 32px" id="time">00:00:00</span>
            <sub><span id="todate"></span></sub>
          </p>
        </div>
        <div class="col-xs-12" style="margin-top: 12px">
          <select
            style="
              border: 1px solid gainsboro;
              padding: 5px;
              width: 205px;
              background: white;
              outline: none;
              border-radius: 13px;
              box-shadow: 0 0px 7px 0 rgb(0 0 0 / 20%),
                0 0px 0px 0 rgb(0 0 0 / 19%);
            "
           id='myjobs'>
            <option>Choose Job</option>
          </select>
        </div>--
        <div class="col-sm-2 col-xs-12" style="margin-top: 12px">
		<div class='timer_started'></div>
          <button
            type="button"
            class="btn play_timer" id='play_timer'
            style="
              outline: none;
              color: green;
              padding: 3px 8px;
              border-radius: 50%;
              background: white;
              font-size: 15px;
              box-shadow: 0 0px 7px 0 rgb(0 0 0 / 20%),
                0 0px 0px 0 rgb(0 0 0 / 19%);
            "
          >
            <i class="fa fa-play"></i>
          </button>
          <button
            type="button"
            class="btn btn-stop"
            style="
              outline: none;
              color: #f44336;
              padding: 3px 8px;
              border-radius: 50%;
              background: white;
              font-size: 15px;
              box-shadow: 0 0px 7px 0 rgb(0 0 0 / 20%),
                0 0px 0px 0 rgb(0 0 0 / 19%);
            "
          >
            <i class="fa fa-stop"></i>
          </button>
        </div>-->
      </div>

      <div class="row" style="margin: 20px">
        <div class="col-sm-12" style="border-bottom: 1px solid black">
		<button type='button' class="btn btn-small btn-danger pull-right btn-logout" style="padding:2px 4px;"> Logout </button>
          <h3 class="clientname">Client Name</h3>
        </div>
      </div>

      <div class="row text-left message_box" style="margin: 20px;height:400px; overflow-y:auto">
        
      </div>

      <div class="row" style="margin-top: 10%">
        <div class="col-sm-12">
            <div class="form-group">
              <textarea
                class="form-control message_chat"
                style="border-radius: 21px"
                rows="4"
                id="comment"
                placeholder="Type your message here"
              ></textarea>
			  <div class='col-xs-6 text-left' style="padding-top:4px">
			  <input type="file" id="attached_file" name="files[]" accept='image/*' multiple class='hidden' >
                                <label for="attached_file" class='attach'>
                                    Attach files
                                </label>
			  </div>
			   <div class='col-xs-6'>
			  <input type="submit" style="margin-top:4px" disabled class="pull-right btn-send_msg btn btn-primary" value='Send'>
            </div>
			</div>
        </div>
		<div class="col-sm-12 text-left">
                <div class="attach_waper"style="color:#428bca;" ></div>  
            </div>
      </div>

      <div class="row" style="margin-top: 15px">
        <div>
          <a
            href="chatscreen.html"
            class="btn"
            style="
              color: 46a9d7;
              border: 1px solid white;
              background-color: white;
              outline: none;
              padding: 3px 26px;
            "
            ><i class="fa fa-home"></i> Back to Home</a
          >
        </div>
      </div>
    </div>
  </body>
  <script>
  
	 lightbox.option({
      'alwaysShowNavOnTouchDevices':true,
	  'showImageNumberLabel':false
    })
	var userid = localStorage.getItem("u_id");
	var auth=localStorage.getItem("auth");
	const { ipcRenderer } = require('electron')
	console.log('Current Job',localStorage.getItem("current_job"));
	function getIdle(){
	
		 ipcRenderer.invoke('get_idle', '').then((result) => {
			console.log(' Idle ' + result);
			if(result >= 30){
				clearInterval(timerVar);
				clearInterval(screencapture);
				clearInterval(idlestate);
				clearInterval(total_hours);
				$('#play_timer').addClass('play_timer');
				$('.timer_started').html('<p style="color:red"><b>Not Working...</b> </p>');
				localStorage.setItem("working","no")
				alert('You are not Working!');
				
				var today = new Date();
				var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
				var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
				var dateTime = date+' '+time;
				
				<!-- logobject.endTime = dateTime; -->
				<!-- LogsArray.push(logobject); -->
				<!-- console.log(LogsArray); -->
				var working_job = localStorage.getItem("current_job");
				var starttime = localStorage.getItem("start_time"+working_job);
				localStorage.setItem("pause_time"+working_job,dateTime);
				var LogsArray = [{start_time:starttime,u_id:userid,job_id:working_job,endTime:dateTime}];
				var auth=localStorage.getItem("auth");
				var jsondata = new FormData();
				jsondata.append("logs", JSON.stringify(LogsArray));
			   $.ajax({
				   url:"https://surfnwork.com/Authentication/save_logs",
				   type:"post",
					cache: false,
					contentType:false,
					processData:false,
					dataType: "json",
					headers: {
						'Auth': auth
					},
					data:jsondata,
					success:function(reponse){
						if(reponse.status){
							LogsArray = [];
							logobject = {};
						 }
					   }
					 });		
				
			}
		});
		
	}
	var totalSeconds = localStorage.getItem(userid+"option_"+localStorage.getItem("current_job"));
		console.log("totalSeconds -- " + totalSeconds)
	setInterval(continue_time,1000);
	function continue_time(){
		if(localStorage.getItem("working")== "yes"){
		
		localStorage.setItem(userid+"option_"+localStorage.getItem("current_job"),++totalSeconds);
		
		}
	}
	var idlestate; var total_hours;
	if(localStorage.getItem("working")== "yes"){
		 idlestate = setInterval(getIdle,1000);
		 total_hours =  setInterval(save_total_hr_work,10000);
		 
		 $('#stop_timer').addClass('btn-stop');
	}
	
	function save_total_hr_work(){
  
		var jsondata = new FormData();
			jsondata.append("job_id", localStorage.getItem("current_job")); 
			jsondata.append("time_worked", totalSeconds); 
			var auth=localStorage.getItem("auth");
			$.ajax({
				url: "https://surfnwork.com/Authentication/start_job", 
				type: 'POST',
				contentType:false,
				processData:false,
				cache: false,
				headers: {
                'Auth': auth
				},
				dataType: "json",
				data: jsondata,
				success: function (reponse) { 
					seconds_worked = 0;
				}
			});
  
  }
	$('input[type="submit"]').attr('disabled', true);
    
    $('textarea').on('keyup',function() {
        var textarea_value = $(".message_chat").val();
        
        if(textarea_value != '') {
            $('input[type="submit"]').attr('disabled', false);
        } else {
            $('input[type="submit"]').attr('disabled', true);
        }
    });
	
	$(document).on('click','.btn-logout',function(){
		localStorage.clear();
		window.location.href= "login.html";
	});
	
		$('#attached_file').change(function(){
                $('.attach_waper').html('');
                var $fileUpload = $("input[type='file']");
                if(parseInt($fileUpload.get(0).files.length)>4){
                    alert("You can only upload a maximum of 4 files");
                 
                }else{
                    
                    for(var i = 0 ; i < this.files.length ; i++){
                      var fileName = this.files[i].name;
                      $('.attach_waper').append("<div style='display:inline-block'><i class='glyphicon glyphicon-paperclip' style='color:#428bca!important;'></i> "+fileName + ' <i class="fa fa-times-circle remove_file" style="color:red;cursor:pointer" data-file="'+fileName+'" ></i> , </div> ');
                    }
                }
            });
	
  
  
	var job_id = localStorage.getItem('job_id');
	var recv_id = localStorage.getItem('juid');
	var seller_id = localStorage.getItem('u_id');
	var clientname = localStorage.getItem('clientname');
	var auth=localStorage.getItem("auth");
	$('.clientname').text(clientname);
	
			var getmessages = new FormData();
			getmessages.append("job_id", job_id);
			getmessages.append("recv_id", recv_id);
		$.ajax({
			url: "https://surfnwork.com/Authentication/Convo", 
			type: 'POST',
			cache: false,
			contentType:false,
			processData:false,
			dataType: "json",
		    headers: {
					'Auth': auth
				},
			data : getmessages ,
			beforeSend:function(){
				$('.message_box').html('<p class="text-center"><i class="fa fa-spinner fa-spin"></i></p>');
			},
			success: function (reponse) { 
				
			  if(reponse.status){
				var message = reponse.data;
				console.log(reponse);
				 if(message.length > 0){
					var mess = "";
					for(var i=0 ; i < message.length ; i++){
					 if(message[i].custom_status_extent == 0){
					 
						var files = message[i].files;
						var attachments = "";
						if(files.length > 0){
							for(var j = 0; j < files.length ; j++){
								attachments +="<a href='https://surfnwork.com/"+files[j].file+"'   data-lightbox='gallery'><img src='https://surfnwork.com/"+files[j].file+"' width='60px' height='60px' class='img img-thumbnail'></a>";
							}
						}
						
						if(message[i].send_id != seller_id ){
							mess +='<div data-lastid="'+message[i].msg_id+'" class="col-sm-12 boxm" style="margin-top: 10px; overflow: hidden"><div class="col-xs-9 coleft"><p class="fontsize">'+message[i].content+'</p> '+attachments+' <span class="time">'+message[i].date+'</span></div></div>'
						}else{
						 mess +='<div class="col-sm-12 boxm" data-lastid="'+message[i].msg_id+'" style="margin-top: 10px; overflow: hidden"><div class="col-xs-9 coright"><p class="fontsize">'+message[i].content+'</p> '+attachments+' <span class="time">'+message[i].date+'</span></div></div>'	;
						
						}
					  }
					}
					
					$('.message_box').html(mess);
				 }else{
				 $('.message_box').html('<p class="text-center">No Message Found Yet!</p>');
				 }
				<!-- for(var i=0;i<clients.length;i++){ -->
				  <!-- var client = clients[i]; -->
				  <!-- result2 += '<p style="text-overflow: ellipsis;width: 100%;white-space: nowrap;overflow: hidden;"><a href="#" data-uid="'+client.u_id+'" style="color: black; text-decoration: none" class="open_chat"><span style="background: red;padding: 4px 6px;color: white;border-radius: 50%;margin-right: 11px;/* width: 24px; *//* height: 24px; */">1</span><strong>'+client.f_name+' '+client.l_name+'</strong></a></p>'; -->
				  <!-- lastoneline += "<p><strong> 2Hrs Ago </strong></p>"; -->
				<!-- } -->
				
			  }else{
				alert(reponse.message);
			  }
		   
			}
		})
		
		$(document).on('click','.remove_file',function(){
            
            var fileUpload = $("input[type='file']");
            
             var file = $(this).data("file");
              for (var i = 0; i < fileUpload.length; i++) {
                if (fileUpload[i].name === file) {
                  fileUpload.splice(i, 1);
                  break;
                }
              }
              $(this).parent().remove();
        });
       
		
		setInterval(get_new_msg, 5000);
		
		// Send Message
		
		$(document).on('click','.btn-send_msg',function(){
			var ele = $(this);
			var jsondata = new FormData();
			var textarea_value = $(".message_chat").val();
			jsondata.append("job_id", job_id);
			jsondata.append("content", textarea_value);
			jsondata.append("recv_id", recv_id);
			var filesLength = document.getElementById('attached_file').files.length;
			for(var i=0;i<filesLength;i++){
				jsondata.append("files[]", $('input[type=file]')[0].files[i]);
			}
			$.ajax({
			url: "https://surfnwork.com/Authentication/SendMsg", 
			type: 'POST',
			cache: false,
			contentType:false,
			processData:false,
			dataType: "json",
		    headers: {
					'Auth': auth
				},
			data :jsondata,
			beforeSend:function(){
				ele.html('Sending <i class="fa fa-spinner fa-spin"></i></p>');
			},
			success: function (reponse) { 
					ele.html('Send');
					$('.attach_waper').html('');
					$(".message_chat").val('')
				}
			})
		});
		
		/// Send Message On Enter Press
		
		$(document).on('keypress','.message_chat',function(e){
			var textarea_value = $(".message_chat").val();
			var jsondata = new FormData();
			jsondata.append("job_id", job_id);
			jsondata.append("content", textarea_value);
			jsondata.append("recv_id", recv_id);
			var filesLength = document.getElementById('attached_file').files.length;
			for(var i=0;i<filesLength;i++){
				jsondata.append("files[]", $('input[type=file]')[0].files[i]);
			}
			 var key = e.which;
			 if(key == 13){
			
				$.ajax({
				url: "https://surfnwork.com/Authentication/SendMsg", 
				type: 'POST',
				cache: false,
				contentType:false,
				processData:false,
				dataType: "json",
				headers: {
						'Auth': auth
					},
				data : jsondata ,
				beforeSend:function(){
					$('.btn-send_msg').html('<p class="text-center"><i class="fa fa-spinner fa-spin"></i></p>');
				},
				success: function (reponse) { 
						$('.attach_waper').html('');
						$('.btn-send_msg').html('Send');
						$(".message_chat").val('')
					}
				})
			
			}
	
		});
		
		function get_new_msg(){ 
        
        var msg_id = $('.boxm:last').data("lastid");
		var jsondata = new FormData();
		jsondata.append("job_id", job_id);
		jsondata.append("recv_id", recv_id);
		jsondata.append("msg_id", msg_id);
          $.ajax({
            url: "https://surfnwork.com/Authentication/new_msg", 
			type: 'POST',
			cache: false,
			contentType:false,
			processData:false,
			dataType: "json",
		    headers: {
					'Auth': auth
				},
			data : jsondata ,
            success: function(reponse){ 
              
			  var message = reponse.data;
				console.log(reponse);
				 if(message.length > 0){
					var mess = "";
					for(var i=0 ; i < message.length ; i++){
					 if(message[i].custom_status_extent == 0){
						
						var files = message[i].files;
						var attachments = "";
						if(files.length > 0){
							for(var j = 0; j < files.length ; j++){
								attachments +="<a href='https://surfnwork.com/"+files[j].file+"'   data-lightbox='gallery'><img src='https://surfnwork.com/"+files[j].file+"' width='60px' height='60px' class='img img-thumbnail'></a>";
							}
						}
						
						if(message[i].send_id != seller_id ){
							mess +='<div data-lastid="'+message[i].msg_id+'" class="col-sm-12 boxm" style="margin-top: 10px; overflow: hidden"><div class="col-xs-9 coleft"><p class="fontsize">'+message[i].content+'</p> '+attachments+' <span class="time">'+message[i].date+'</span></div></div>'
						}else{
						 mess +='<div class="col-sm-12 boxm" data-lastid="'+message[i].msg_id+'" style="margin-top: 10px; overflow: hidden"><div class="col-xs-9 coright"><p class="fontsize">'+message[i].content+'</p> '+ attachments +'<span class="time">'+message[i].date+'</span></div></div>'	;
						
						}
					  }
					}
					
					$('.message_box').append(mess);
					$(".message_box").scrollTop(8500)
				}
			}
          });
    }
		
		
		
		
		
	var timerVar; var screencapture;
   var d = new Date();
  var strDate = (d.getMonth()+1) + "/" + d.getDate() + "/" + d.getFullYear();
  $("#todate").html(strDate);


	

  //api calls
  <!-- $.ajax({ -->
        <!-- url: "https://surfnwork.com/Authentication/get_jobs",  -->
        <!-- type: 'POST', -->
        <!-- cache: false, -->
        <!-- contentType:false, -->
        <!-- processData:false, -->
        <!-- dataType: "json", -->
       <!-- headers: { -->
                <!-- 'Auth': auth -->
            <!-- }, -->
        <!-- success: function (reponse) {  -->
    
        
      <!-- if(reponse.status){ -->
      <!-- console.log(reponse); -->
      <!-- var jobs=reponse.data; -->
        <!-- var sel = $("#myjobs"); -->

    <!-- sel.empty(); -->
    <!-- for (var i=0; i<jobs.length; i++) { -->
      <!-- var single=jobs[i]; -->
      <!-- sel.append('<option value="' + single.job_id + '">' + single.job_title+ '</option>'); -->
      
    <!-- } -->
      <!-- }else{ -->
        <!-- alert(reponse.message); -->
      <!-- } -->
       
        <!-- }  -->
 
      <!-- }); -->
//api calls
	var playing = true;
	$(document).on('click','.play_timer',function(){
	$('.timer_started').html('<p style="color:green"><b>Working</b> </p>');
			screencapture = setInterval(take_screenshot, 5000);
			timerVar = setInterval(countTimer, 1000);
			$(this).removeClass('play_timer');
	});
	
	$(document).on('click','.btn-stop',function(){
		$('.timer_started').html('<p style="color:red"><b>Not Working</b> </p>');
		clearInterval(timerVar);
		clearInterval(screencapture);
		$(this).siblings('button').addClass('play_timer');
	
	});
	
	$(document).on('focus','#myjobs',function(){
			var previous = $(this).val();
			console.log('previous' + previous)
			
			var key  = userid+"option_"+previous;
			localStorage.setItem(key,totalSeconds);
			
	});
	
    $(document).on('change','#myjobs',function(){
      var vals=$(this).val();
		clearInterval(timerVar);
		clearInterval(screencapture);
		//$("#time").html("00:00:00");
		$('.timer_started').html('<p style="color:darkblue"><b>Start Working</b> </p>');
		$('#play_timer').addClass('play_timer');
		console.log(localStorage.getItem(userid+"option_"+vals));
		if(localStorage.getItem(userid+"option_"+vals) == "null"){
			totalSeconds = 0;
			$("#time").html("00:00:00")
		}else{
			totalSeconds = localStorage.getItem(userid+"option_"+vals);
			var hour = Math.floor(totalSeconds /3600);
           var minute = Math.floor((totalSeconds - hour*3600)/60);
           var seconds = totalSeconds - (hour*3600 + minute*60);
           if(hour < 10)
             hour = "0"+hour;
           if(minute < 10)
             minute = "0"+minute;
           if(seconds < 10)
             seconds = "0"+seconds;
           document.getElementById("time").innerHTML = hour + ":" + minute + ":" + seconds;
		}
var auth=localStorage.getItem("auth");
       $.ajax({
           url:"https://surfnwork.com/Authentication/job_stats",
           type:"post",
           data:vals,
             cache: false,
        contentType:false,
        processData:false,
        dataType: "json",
       headers: {
                'Auth': auth
            },
           success:function(reponse)
           {
              if(reponse.status){
				var jobs= reponse.data.jobs_logs 
				var userdetail=reponse.data.jobs_stats;
				$('#totalhour').html(userdetail.total_hours_worked);
				 $('#ideltime').html(userdetail.idle_time);

				 for (var i=0; i<jobs.length; i++) {
					var single=jobs[i];
					$('#jobstart').html(single.job_started);
					$('#jobspased').html(single.job_paused);
					 $('#jobsidle').html(single.idle);
					 $('#job_paused').html(single.job_paused);
				  }
				
			  }else{
				alert('no');
			  }
           }
       });
    });

//});

function updateClock (){
  var currentTime = new Date ( );
    var currentHours = currentTime.getHours ( );
    var currentMinutes = currentTime.getMinutes ( );
    var currentSeconds = currentTime.getSeconds ( );

    // Pad the minutes and seconds with leading zeros, if required
    currentMinutes = ( currentMinutes < 10 ? "0" : "" ) + currentMinutes;
    currentSeconds = ( currentSeconds < 10 ? "0" : "" ) + currentSeconds;

    // Choose either "AM" or "PM" as appropriate
    var timeOfDay = ( currentHours < 12 ) ? "AM" : "PM";

    // Convert the hours component to 12-hour format if needed
    currentHours = ( currentHours > 12 ) ? currentHours - 12 : currentHours;

    // Convert an hours component of "0" to "12"
    currentHours = ( currentHours == 0 ) ? 12 : currentHours;

    // Compose the string for display
    var currentTimeString = currentHours + ":" + currentMinutes + ":" + currentSeconds + " " + timeOfDay;
    
    
    //$("#time").html(currentTimeString);      
 }
 
 function take_screenshot(){
	var screenshot = require('screenshot-desktop');
	var fs = require('fs');
	var path = require('path');
	//var form = require('form-data');
	
	const imgpath = "screenshots/screenshot"+Date.now() + '.png';
	screenshot({ filename: imgpath }).then((imgpath) => {
	
			var blobObject = blobCreationFromURL(imgpath); 
			var image;
			getBase64Image(imgpath, function(base64image){
				// console.log(base64image);
				 image = base64image;
					var jsondata = new FormData();
					jsondata.append("data", base64image); 
					jsondata.append("job_id", localStorage.getItem("current_job")); 
		  
					$.ajax({
						url: "https://surfnwork.com/Authentication/upload_pic", 
						type: 'POST',
						contentType:false,
						processData:false,
						cache: false,
						dataType: "json",
						data: jsondata,
						success: function (reponse) { 
						
						}
					});
			});
			
			
	  
	});
 
}
 

<!-- var totalSeconds = 0; -->
<!-- function countTimer() { -->
           <!-- ++totalSeconds; -->
           <!-- var hour = Math.floor(totalSeconds /3600); -->
           <!-- var minute = Math.floor((totalSeconds - hour*3600)/60); -->
           <!-- var seconds = totalSeconds - (hour*3600 + minute*60); -->
           <!-- if(hour < 10) -->
             <!-- hour = "0"+hour; -->
           <!-- if(minute < 10) -->
             <!-- minute = "0"+minute; -->
           <!-- if(seconds < 10) -->
             <!-- seconds = "0"+seconds; -->
           <!-- document.getElementById("time").innerHTML = hour + ":" + minute + ":" + seconds; -->
<!-- } -->




	
	
  </script>
</html>
